# ============================================================================
# Docker Compose Configuration
# ============================================================================
# Media server and home automation stack
# Services: Plex, Sonarr, Radarr, Transmission, Home Assistant, and more

version: '3.3'

volumes:
  portainer_data:

services:
  # ==========================================================================
  # Plex Media Server
  # ==========================================================================
  # Stream movies, TV shows, and other media to devices
  plex:
    container_name: plex
    restart: always
    network_mode: host
    environment:
      - TZ=America/Los_Angeles
      - PLEX_CLAIM=claim-eU-xGCDwJvizpq_LEuNS
    volumes:
      - /home/plex:/root/Library
      - /mnt/data/Transcode:/transcode
      - /mnt/data:/media
    image: jaymoulin/plex

  # ==========================================================================
  # Home Assistant
  # ==========================================================================
  # Home automation platform
  home-assistant:
    container_name: home-assistant
    restart: always
    environment:
      - TZ=America/Los_Angeles
    ports:
      - 8123:8123
    volumes:
      - /home/pt/homeassistant-config:/config
      - /etc/letsencrypt/:/ssl
    image: homeassistant/raspberrypi4-homeassistant:stable

  # ==========================================================================
  # Sonarr
  # ==========================================================================
  # TV show library manager and automatic downloader
  sonarr:
    container_name: sonarr
    restart: always
    environment:
      - PUID=1002
      - PGID=1002
      - TZ=America/Los_Angeles
      - UMASK_SET=022
    ports:
      - 8989:8989
    volumes:
      - /home/sonarr:/config
      - /mnt/data/TV/:/tv
      - /mnt/data/Downloads:/downloads
    image: linuxserver/sonarr

  # ==========================================================================
  # Transmission
  # ==========================================================================
  # BitTorrent client with web interface
  transmission:
    container_name: transmission
    restart: always
    environment:
      - PGID=1003
      - PUID=1003
      - TZ=Americas/Los_Angeles
    ports:
      - 9091:9091      # Web UI
      - 51413:51413    # Peer port (TCP)
      - 51413:51413/udp # Peer port (UDP)
    volumes:
      - /home/transmission/config:/config
      - /mnt/data/Downloads:/downloads
      - /mnt/data/Watch:/watch
    image: linuxserver/transmission

  # ==========================================================================
  # Deluge
  # ==========================================================================
  # Alternative BitTorrent client
  deluge:
    container_name: deluge
    network_mode: host
    environment:
      - PUID=1007
      - PGID=1007
      - TZ=Europe/London
      - DELUGE_LOGLEVEL=error #optional
    volumes:
      - /home/deluge:/config
      - /mnt/data/Downloads:/downloads
    restart: unless-stopped
    image: linuxserver/deluge

  # ==========================================================================
  # Jackett
  # ==========================================================================
  # Indexer proxy for torrent trackers
  jackett:
    container_name: jackett
    restart: always
    environment:
      - PUID=1004
      - PGID=1004
      - TZ=Americas/Los_Angeles
    volumes:
      - /home/jacket:/config
      - /mnt/data/Downloads:/downloads
    ports:
      - 9117:9117
    image: linuxserver/jackett

  # ==========================================================================
  # CouchPotato (Disabled)
  # ==========================================================================
  # Movie library manager (replaced by Radarr)
#   couchpotato:
#     container_name: couchpotato
#     restart: always
#     environment:
#       - PUID=1005
#       - PGID=1005
#       - TZ=Americas/Los_Angeles
#     ports:
#       - 5050:5050
#     volumes:
#       - /home/couchpotato:/config
#       - /mnt/data/Downloads:/downloads
#       - /mnt/data/Movies:/movies
#     image: linuxserver/couchpotato

  # ==========================================================================
  # Radarr
  # ==========================================================================
  # Movie library manager and automatic downloader
  radarr:
    container_name: radarr
    restart: always
    environment:
      - PUID=1006
      - PGID=1006
      - TZ=Americas/Los_Angeles
    volumes:
      - /home/radarr:/config
      - /mnt/data/Downloads:/downloads
      - /mnt/data/Movies:/movies
    ports:
      - 7878:7878
    image: linuxserver/radarr

  # ==========================================================================
  # Node-RED
  # ==========================================================================
  # Flow-based programming tool for automation
  node-red:
    container_name: node-red
    image: nodered/node-red:latest
    environment:
      - TZ=Americas/Los_Angeles
    ports:
      - 1880:1880
    volumes:
      - /home/pt/node-red:/data

  # ==========================================================================
  # Portainer
  # ==========================================================================
  # Docker container management UI
  portainer:
    container_name: portainer
    image: portainer/portainer
    command: -H unix:///var/run/docker.sock
    restart: always
    ports:
      - 9000:9000  # Web UI
      - 8000:8000  # Edge agent
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - portainer_data:/data

  # ==========================================================================
  # Pi-hole
  # ==========================================================================
  # Network-wide ad blocker and DNS server
  pihole:
    container_name: pihole
    image: pihole/pihole:latest
    ports:
      - "53:53/tcp"    # DNS
      - "53:53/udp"    # DNS
      - "67:67/udp"    # DHCP
      - "80:80/tcp"    # Web interface
    environment:
      - TZ=America/Los_Angeles
    volumes:
      - './etc-pihole/:/etc/pihole/'
      - './etc-dnsmasq.d/:/etc/dnsmasq.d/'
    cap_add:
      - NET_ADMIN
    restart: unless-stopped

  # ==========================================================================
  # Tautulli
  # ==========================================================================
  # Plex monitoring and statistics tool
  tautulli:
    image: linuxserver/tautulli
    container_name: tautulli
    environment:
      - PUID=1008
      - PGID=1008
      - TZ=America/Los_Angeles
    volumes:
      - /home/tautulli:/config
    ports:
      - 8181:8181
    restart: unless-stopped
